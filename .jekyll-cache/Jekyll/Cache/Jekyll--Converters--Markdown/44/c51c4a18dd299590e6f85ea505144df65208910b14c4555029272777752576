I"âY<h1 id="æœ‰åç®¡é“fifo">æœ‰åç®¡é“ï¼ˆFIFOï¼‰</h1>

<p>å‘½åç®¡é“ä¹Ÿè¢«ç§°ä¸º <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ã€‚ç”±äº linux æ‰€æœ‰çš„äº‹ç‰©éƒ½å¯ä»¥è¢«è§†ä¸ºæ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹å‘½åç®¡é“çš„ä½¿ç”¨ä¹Ÿå°±å˜å¾—ä¸æ–‡ä»¶æ“ä½œéå¸¸ç»Ÿä¸€ã€‚</p>

<h1 id="åˆ›å»ºå‘½åç®¡é“">åˆ›å»ºå‘½åç®¡é“</h1>

<p>ç”¨å¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¯ä»¥åˆ›å»ºå‘½åç®¡é“ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">mkfifo</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">mknod</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span> <span class="o">|</span> <span class="n">S_IFIFO</span><span class="p">,</span> <span class="p">(</span><span class="n">dev_t</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">filname</code> æ˜¯æŒ‡æ–‡ä»¶åï¼Œè€Œ <code class="language-plaintext highlighter-rouge">mode</code> æ˜¯æŒ‡å®šæ–‡ä»¶çš„è¯»å†™æƒé™ã€‚<code class="language-plaintext highlighter-rouge">mknod</code> æ˜¯æ¯”è¾ƒè€çš„å‡½æ•°ï¼Œè€Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">mkfifo</code> å‡½æ•°æ›´åŠ ç®€å•å’Œè§„èŒƒï¼Œæ‰€ä»¥å»ºè®®ç”¨ <code class="language-plaintext highlighter-rouge">mkfifo</code>ã€‚</p>

<h1 id="æ‰“å¼€å‘½åç®¡é“">æ‰“å¼€å‘½åç®¡é“</h1>

<p>å’Œæ‰“å¼€å…¶ä»–æ–‡ä»¶ä¸€æ ·ï¼Œå¯ä»¥ç”¨ open æ¥æ‰“å¼€ã€‚é€šå¸¸æœ‰å››ç§æ–¹æ³•ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span><span class="c1">//1</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_RDONLY</span> <span class="o">|</span> <span class="n">O_NONBLOCK</span><span class="p">);</span><span class="c1">//2</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="p">);</span><span class="c1">//3</span>
<span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_NONBLOCK</span><span class="p">);</span><span class="c1">//4</span>
</code></pre></div></div>

<p><strong>æœ‰ä¸¤ç‚¹è¦æ³¨æ„:</strong></p>

<p>aã€ç¨‹åºä¸èƒ½ä»¥ <code class="language-plaintext highlighter-rouge">O_RDWR</code> (è¯»å†™)æ¨¡å¼æ‰“å¼€ <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œå› å…¶è¡Œä¸ºä¹Ÿæœªæ˜ç¡®å®šä¹‰ï¼Œå› ä¸ºå¦‚ä¸€ä¸ªç®¡é“ä»¥è¯»/å†™æ–¹å¼æ‰“å¼€ï¼Œè¿›ç¨‹å°±ä¼šè¯»å›è‡ªå·±çš„è¾“å‡ºï¼ŒåŒæ—¶æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ FIFO åªæ˜¯ä¸ºäº†å•å‘çš„æ•°æ®ä¼ é€’ã€‚</p>

<p>bã€ä¼ é€’ç»™ <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨çš„æ˜¯ <code class="language-plaintext highlighter-rouge">FIFO</code> çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯æ­£å¸¸çš„æ–‡ä»¶ã€‚å¦‚ï¼š<code class="language-plaintext highlighter-rouge">const char *fifo_name = "/tmp/my_fifo"; </code></p>

<p>cã€ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„é€‰é¡¹ <code class="language-plaintext highlighter-rouge">O_NONBLOCK</code>ï¼Œé€‰é¡¹ <code class="language-plaintext highlighter-rouge">O_NONBLOCK</code> è¡¨ç¤ºéé˜»å¡ï¼ŒåŠ ä¸Šè¿™ä¸ªé€‰é¡¹åï¼Œè¡¨ç¤º <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨æ˜¯éé˜»å¡çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œåˆ™è¡¨ç¤º <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨æ˜¯é˜»å¡çš„ã€‚</p>

<h1 id="é˜»å¡é—®é¢˜">é˜»å¡é—®é¢˜</h1>

<p>å¯¹äºä»¥åªè¯»æ–¹å¼ <code class="language-plaintext highlighter-rouge">O_RDONLY</code> æ‰“å¼€çš„ <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ï¼Œå¦‚æœ <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨æ˜¯é˜»å¡çš„ï¼ˆå³ç¬¬äºŒä¸ªå‚æ•°ä¸º <code class="language-plaintext highlighter-rouge">O_RDONLY</code>ï¼‰ï¼Œé™¤éæœ‰ä¸€ä¸ªè¿›ç¨‹ä»¥å†™æ–¹å¼æ‰“å¼€åŒä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code>ï¼Œå¦åˆ™å®ƒä¸ä¼šè¿”å›ï¼›</p>

<p>å¦‚æœ <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨æ˜¯éé˜»å¡çš„çš„ï¼ˆå³ç¬¬äºŒä¸ªå‚æ•°ä¸º <code class="language-plaintext highlighter-rouge">O_RDONLY | O_NONBLOCK</code> ï¼‰ï¼Œåˆ™å³ä½¿æ²¡æœ‰å…¶ä»–è¿›ç¨‹ä»¥å†™æ–¹å¼æ‰“å¼€åŒä¸€ä¸ª FIFO æ–‡ä»¶ï¼Œopenè°ƒç”¨å°†æˆåŠŸå¹¶ç«‹å³è¿”å›ã€‚</p>

<p>å¯¹äºä»¥åªå†™æ–¹å¼ï¼ˆ<code class="language-plaintext highlighter-rouge">O_WRONLY</code>ï¼‰æ‰“å¼€çš„ <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ï¼Œå¦‚æœ <code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨æ˜¯é˜»å¡çš„ï¼ˆå³ç¬¬äºŒä¸ªå‚æ•°ä¸º <code class="language-plaintext highlighter-rouge">O_WRONLY</code> ï¼‰ï¼Œopen è°ƒç”¨å°†è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªè¿›ç¨‹ä»¥åªè¯»æ–¹å¼æ‰“å¼€åŒä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ä¸ºæ­¢ï¼›</p>

<p>å¦‚æœ open è°ƒç”¨æ˜¯éé˜»å¡çš„ï¼ˆå³ç¬¬äºŒä¸ªå‚æ•°ä¸º <code class="language-plaintext highlighter-rouge">O_WRONLY | O_NONBLOCK</code> ï¼‰æ€»ä¼šç«‹å³è¿”å›ï¼Œä½†å¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹ä»¥åªè¯»æ–¹å¼æ‰“å¼€åŒä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ï¼Œ<code class="language-plaintext highlighter-rouge">open</code> è°ƒç”¨å°†è¿”å›- 1ï¼Œå¹¶ä¸” <code class="language-plaintext highlighter-rouge">FIFO</code> ä¹Ÿä¸ä¼šè¢«æ‰“å¼€ã€‚</p>

<h1 id="ä½¿ç”¨-fifo-å®ç°è¿›ç¨‹é—´çš„é€šä¿¡">ä½¿ç”¨ FIFO å®ç°è¿›ç¨‹é—´çš„é€šä¿¡</h1>

<p>ç®¡é“çš„å†™å…¥ç«¯ä»ä¸€ä¸ªæ–‡ä»¶è¯»å‡ºæ•°æ®ï¼Œç„¶åå†™å…¥å†™ç®¡é“ã€‚ç®¡é“çš„è¯»å–ç«¯ä»ç®¡é“è¯»å‡ºåå†™åˆ°æ–‡ä»¶ä¸­ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//å†™å…¥ç«¯ä»£ç ï¼šfifowrite.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;limits.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span> 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fifo_name</span> <span class="o">=</span> <span class="s">"/tmp/my_fifo"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">pipe_fd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">data_fd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">open_mode</span> <span class="o">=</span> <span class="n">O_WRONLY</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bytes_sent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">PIPE_BUF</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span><span class="n">fifo_name</span><span class="p">,</span> <span class="n">F_OK</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span> <span class="p">(</span><span class="s">"Create the fifo pipe.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mkfifo</span><span class="p">(</span><span class="n">fifo_name</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Could not create fifo %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">fifo_name</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d opening FIFO O_WRONLY</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">pipe_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">fifo_name</span><span class="p">,</span> <span class="n">open_mode</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d result %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">(),</span> <span class="n">pipe_fd</span><span class="p">);</span>
 
    <span class="k">if</span><span class="p">(</span><span class="n">pipe_fd</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">data_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"Data.txt"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data_fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">close</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">);</span>
            <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Open file[Data.txt] failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data_fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">PIPE_BUF</span><span class="p">);</span>
        <span class="n">buffer</span><span class="p">[</span><span class="n">bytes_read</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">bytes_read</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">bytes_read</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Write error on pipe</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">bytes_sent</span> <span class="o">+=</span> <span class="n">res</span><span class="p">;</span>
            <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">data_fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">PIPE_BUF</span><span class="p">);</span>
            <span class="n">buffer</span><span class="p">[</span><span class="n">bytes_read</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">data_fd</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d finished</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">//ç®¡é“è¯»å–ç«¯ fiforead.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;limits.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span> 
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fifo_name</span> <span class="o">=</span> <span class="s">"/tmp/my_fifo"</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">pipe_fd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">data_fd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">open_mode</span> <span class="o">=</span> <span class="n">O_RDONLY</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">PIPE_BUF</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">bytes_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bytes_write</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 
    <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
 
    <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d opening FIFO O_RDONLY</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
    <span class="n">pipe_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">fifo_name</span><span class="p">,</span> <span class="n">open_mode</span><span class="p">);</span>
    <span class="n">data_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"DataFormFIFO.txt"</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data_fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Open file[DataFormFIFO.txt] failed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d result %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">pipe_fd</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pipe_fd</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">do</span>
        <span class="p">{</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">PIPE_BUF</span><span class="p">);</span>
            <span class="n">bytes_write</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">data_fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
            <span class="n">bytes_read</span> <span class="o">+=</span> <span class="n">res</span><span class="p">;</span>
        <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_fd</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">data_fd</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
     <span class="n">printf</span><span class="p">(</span><span class="s">"Process %d finished, %d bytes read</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">getpid</span><span class="p">(),</span> <span class="n">bytes_read</span><span class="p">);</span>
     <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="å‘½åç®¡é“çš„å®‰å…¨é—®é¢˜">å‘½åç®¡é“çš„å®‰å…¨é—®é¢˜</h1>

<p>æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼šä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ï¼Œæœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶å‘åŒä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶å†™æ•°æ®ï¼Œè€Œåªæœ‰ä¸€ä¸ªè¯» <code class="language-plaintext highlighter-rouge">FIFO</code> è¿›ç¨‹åœ¨åŒä¸€ä¸ª <code class="language-plaintext highlighter-rouge">FIFO</code> æ–‡ä»¶ä¸­è¯»å–æ•°æ®æ—¶ï¼Œä¼šå‘ç”Ÿæ•°æ®å—çš„ç›¸äº’äº¤é”™ã€‚ä¸åŒè¿›ç¨‹å‘ä¸€ä¸ª FI<code class="language-plaintext highlighter-rouge">FO è¯»è¿›ç¨‹å‘é€æ•°æ®æ˜¯å¾ˆæ™®é€šçš„æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯è®©å†™æ“ä½œçš„åŸå­åŒ–ã€‚ç³»ç»Ÿè§„å®šï¼šåœ¨ä¸€ä¸ªä»¥ </code>O_WRONLY<code class="language-plaintext highlighter-rouge">ï¼ˆå³é˜»å¡æ–¹å¼ï¼‰æ‰“å¼€çš„ </code>FIFO<code class="language-plaintext highlighter-rouge"> ä¸­ï¼Œ å¦‚æœå†™å…¥çš„æ•°æ®é•¿åº¦å°äºç­‰å¾… </code>PIPE_BUF<code class="language-plaintext highlighter-rouge"> ï¼Œé‚£ä¹ˆæˆ–è€…å†™å…¥å…¨éƒ¨å­—èŠ‚ï¼Œæˆ–è€…ä¸€ä¸ªå­—èŠ‚éƒ½ä¸å†™å…¥ã€‚å¦‚æœæ‰€æœ‰çš„å†™è¯·æ±‚éƒ½æ˜¯å‘å¾€ä¸€ä¸ªé˜»å¡çš„ </code>FIFO<code class="language-plaintext highlighter-rouge"> çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå†™è®°è¯·æ±‚çš„æ•°æ®é•¿åº¦å°äºç­‰äº </code>PIPE_BUF` å­—èŠ‚ï¼Œç³»ç»Ÿå°±å¯ä»¥ç¡®ä¿æ•°æ®å†³ä¸ä¼šäº¤é”™åœ¨ä¸€èµ·ã€‚</p>

:ET